[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Météo Montpeul",
    "section": "",
    "text": "import datetime\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport requests\nfrom PIL import Image\nimport json\nimport urllib\n\n# --- Dates ---\naujourd_hui = datetime.date.today()\nfin = aujourd_hui + datetime.timedelta(days=3)\n\n# --- Téléchargement des données météo ---\nurl_daily = (\n    f\"https://api.open-meteo.com/v1/meteofrance?\"\n    f\"latitude=43.6109&longitude=3.8763&\"\n    f\"daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_sum,\"\n    f\"windspeed_10m_max,winddirection_10m_dominant&\"\n    f\"timezone=GMT&start_date={aujourd_hui}&end_date={fin}&format=csv\"\n)\nurl_hourly = (\n    f\"https://api.open-meteo.com/v1/meteofrance?\"\n    f\"latitude=43.6109&longitude=3.8763&\"\n    f\"hourly=windspeed_10m&start_date={aujourd_hui}&end_date={fin}&format=csv\"\n)\n\n# Téléchargement avec timeout\nr_daily = requests.get(url_daily, timeout=30)\nwith open(\"./data/db.csv\", \"wb\") as f:\n    f.write(r_daily.content)\n\nr_hourly = requests.get(url_hourly, timeout=30)\nwith open(\"./data/db1.csv\", \"wb\") as f:\n    f.write(r_hourly.content)\n\n# --- Lecture des CSV ---\ndf = pd.read_csv(\"./data/db.csv\", skiprows=3).fillna(\"-\")\ndf1 = pd.read_csv(\"./data/db1.csv\", skiprows=3)\ndf1.rename(columns={\"windspeed_10m (km/h)\": \"vent\"}, inplace=True)\n\n# Renommer les colonnes pour plus de clarté\ndf.rename(columns={\n    \"weathercode (wmo code)\": \"code\",\n    \"temperature_2m_max (°C)\": \"tmax\",\n    \"temperature_2m_min (°C)\": \"tmin\",\n    \"precipitation_sum (mm)\": \"pluie\",\n    \"windspeed_10m_max (km/h)\": \"vent\",\n    \"winddirection_10m_dominant (°)\" : \"direction\"\n}, inplace=True)\n\n#valeur de la pluie pour l'affichage des gouttes\npluie = df['pluie'].tolist()\n\n#ajout des unités\nfor col, unit in zip(['tmax','tmin','pluie','vent'], ['°C','°C','mm','km/h']):\n    df[col] = df[col].astype(str) + f' {unit}'\n\n#On transpose la dataframe\ndf = df.T\n\n#calcul du vent moyen et remplacement de la valeur dans db\nfor i in range(4):\n    subset = df1.loc[24*i : 24*(i+1)-1]\n    moyenne = subset['vent'].mean()\n    df.iloc[5,i] = round(moyenne , 1)\n    df.iloc[5,i] = str(df.iloc[5,i]) + ' km/h'\n\n#Création du tableau contenant les informations voulues\nfig = plt.figure(figsize=(14,10), dpi=300)\nax = plt.subplot()\n\nncols = df.shape[1]\nnrows = df.shape[0] - 1\n\nax.set_xlim(0, ncols + 1)\nax.set_ylim(0, nrows)\nax.set_axis_off()\n\ncolumns = df.iloc[0].tolist()\n\n# création des dates (nom du jour/numéro/mois)\nnoms_jours = [\"lundi\", \"mardi\", \"mercredi\", \"jeudi\", \"vendredi\", \"samedi\", \"dimanche\"]\nnoms_mois = [\"janvier\", \"février\", \"mars\", \"avril\", \"mai\", \"juin\", \"juillet\", \"août\", \"septembre\", \"octobre\", \"novembre\", \"décembre\"]\n\nfor i in range(ncols):\n    df.iloc[0,i] = pd.to_datetime(df.iloc[0, i], format=\"%Y-%m-%d\")\n    jour_semaine = noms_jours[df.iloc[0,i].weekday()]\n    numero_jour = df.iloc[0,i].day\n    mois = noms_mois[df.iloc[0,i].month - 1]\n    df.iloc[0,i] = f\"{jour_semaine}\\n{numero_jour}\\n{mois}\"\n\n#nom des colonnes\nfor i in range(ncols):\n        ha = 'center'\n        ax.annotate(\n            xy=(i+1, nrows-0.7),\n            text=df.iloc[0,i],\n            ha=ha,\n            va='bottom',\n            weight='bold',\n            fontsize = 15\n        )\n\n\nfor j, column in enumerate(columns):\n        ha = 'center'\n        ax.annotate(\n            xy = (j+1, nrows - 2),\n            text = df.iloc[2,j],\n            ha = ha,\n            va = 'center',\n            weight='bold',\n            fontsize = 12 ,\n            bbox=dict(boxstyle=\"round4\",pad = 0.8, fc=\"indianred\")\n        )\n\nfor j, column in enumerate(columns):\n        ha = 'center'\n        ax.annotate(\n            xy = (j+1, nrows - 3),\n            text = df.iloc[3,j],\n            ha = ha,\n            va = 'center',\n            weight='bold',\n            fontsize = 12 ,\n            bbox=dict(boxstyle=\"round4\", pad = 0.8, fc=\"lightblue\")\n        )\n\n# Ajout du reste des valeurs dans le tableau\nfor i in range(4,nrows):\n    for j, column in enumerate(columns):\n        ha = 'center'\n        ax.annotate(\n            xy = (j+1, nrows - i),\n            text = df.iloc[i,j],\n            ha = ha,\n            weight='bold',\n            fontsize = 12 ,\n            va = 'center'\n        )\n\n#création des lignes de séparations\nax.plot([0.5, 4.5], [nrows, nrows], lw=6, color='black', marker='', zorder=4)\nax.plot([0.5, 4.5], [0.5, 0.5], lw=6, color='black', marker='', zorder=4)\nfor x in range(1, nrows - 1):\n    ax.plot([0.5, 4.5], [x+0.5, x + 0.5], lw=1.15, color='gray', ls=':', zorder=3 , marker='')\n\n# fichier json des icones\nwith open(\"./data/ic.json\", \"r\") as icone: \n    df_ic = json.load(icone)\n\n#fonction pour insérer les images\ndef image_code(code, ax): \n    code_int = int(float(code))\n    url = df_ic[str(code_int)]['day']['image'] \n    image = Image.open(urllib.request.urlopen(url)) \n    ax.imshow(image) \n    ax.axis('off') \n    return ax\n\n#def image_code(code, ax):\n#    \"\"\"\n#    Affiche l'image correspondant au code météo dans l'axe ax.\n#    - code : valeur de la colonne 'code' (peut être float, str ou \"-\")\n#    - ax : matplotlib axis\n#    \"\"\"\n#    try:\n#        # ignorer les valeurs manquantes\n#        if code == \"-\" or pd.isna(code):\n#            return ax\n#\n#        # convertir en int pour correspondre aux clés du json\n#        code_int = int(float(code))\n#        \n#        # récupérer l'URL de l'image\n#        url = df_ic[str(code_int)]['day']['image']\n#        image = Image.open(urllib.request.urlopen(url))\n#        ax.imshow(image)\n#        ax.axis('off')\n#    except (ValueError, KeyError, urllib.error.URLError):\n#        # si code non trouvé ou problème réseau, on ignore l'image\n#        ax.axis('off')\n#    return ax\n\n#Transformation en différents type de coordonnées\nDC_to_FC = ax.transData.transform\nFC_to_NFC = fig.transFigure.inverted().transform\n\n# Take data coordinates and transform them to normalized figure coordinates\nDC_to_NFC = lambda x: FC_to_NFC(DC_to_FC(x))\n\n# Ajout des images du temps\nax_point_1 = DC_to_NFC([0.25, 0.25])\nax_point_2 = DC_to_NFC([0.75, 0.75])\nax_width = abs(ax_point_1[0] - ax_point_2[0])*2\nax_height = abs(ax_point_1[1] - ax_point_2[1])*2\nfor i in range(ncols):\n    ax_coords = DC_to_NFC([i + 0.5, 4.4])\n    ico_ax = fig.add_axes([ax_coords[0], ax_coords[1], ax_width, ax_height])\n    image_code(df.iloc[1,i], ico_ax)\n\n#Ajout des gouttes d'eau\ngt_point_1 = DC_to_NFC([0.25, 0.25])\ngt_point_2 = DC_to_NFC([0.5, 0.5])\ngt_width = abs(gt_point_1[0] - gt_point_2[0])\ngt_height = abs(gt_point_1[1] - gt_point_2[1])\nfor i in range(ncols):\n    ax_coords = DC_to_NFC([ i + 0.55 , 1.9])\n    if type(pluie[i]) == float and pluie[i]&gt;= 0:\n        goutte_ax = fig.add_axes(\n        [ax_coords[0], ax_coords[1], gt_width, gt_height]\n    )\n        image = Image.open(\"./data/goutte.png\")\n        goutte_ax.axis('off')\n        goutte_ax.imshow(image)\n\n#Ajout des directions du vent\nv_point_1 = DC_to_NFC([0.25, 0.25])\nv_point_2 = DC_to_NFC([0.4, 0.4])\nv_width = abs(v_point_1[0] - v_point_2[0])\nv_height = abs(v_point_1[1] - v_point_2[1])\nfor i in range(ncols):\n    if type(df.iloc[6,i]) == float and df.iloc[6,i]&gt;= 0:\n        ax_coords = DC_to_NFC([ i + 0.55 , 0.9])\n        vent_ax = fig.add_axes(\n        [ax_coords[0], ax_coords[1], v_width, v_height]\n        ) \n        vent = Image.open(\"./data/vent.png\")\n        vent = vent.rotate(-df.iloc[6,i])\n        vent_ax.axis('off')\n        vent_ax.imshow(vent)\n\nplt.savefig(\n    'meteo.svg',\n    dpi=300,\n    transparent=True)\n\n\n\n\n\n\n\n\n\n\nSite généré le 2025-12-08 à 16:47:26"
  }
]